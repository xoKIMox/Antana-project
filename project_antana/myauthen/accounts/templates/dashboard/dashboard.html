{% extends "base.html" %}

{% block content %}
<div class="container" style="max-width: 1100px; margin: 20px auto;">

    <!-- หัวข้อหน้า -->
    <h2 style="font-size: 24px; font-weight: 700; margin-bottom: 20px;">
        Dashboard ภาพรวมระบบ
    </h2>

    <!-- แถวบน: KPI Cards -->
    <div style="
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 16px;
        margin-bottom: 24px;
    ">
        <!-- Total Users -->
        <a href="{% url 'custom_admin' %}" style="text-decoration: none;">
            <div style="
                background-color: #ffffff;
                border-radius: 12px;
                border: 1px solid #e5e7eb;
                box-shadow: 0 2px 6px rgba(0,0,0,0.05);
                padding: 14px 16px;
                cursor: pointer;
                transition: transform 0.1s;
            " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                <div style="font-size: 13px; color: #6b7280; margin-bottom: 4px;">
                    Users ทั้งหมด
                </div>
                <div style="font-size: 26px; font-weight: 700; color: #111827;">
                    {{ total_users }}
                </div>
            </div>
        </a>

        <!-- Active today -->
        <a href="{% url 'custom_admin' %}?filter=active_today" style="text-decoration: none;">
            <div style="
                background-color: #ffffff;
                border-radius: 12px;
                border: 1px solid #e5e7eb;
                box-shadow: 0 2px 6px rgba(0,0,0,0.05);
                padding: 14px 16px;
                cursor: pointer;
                transition: transform 0.1s;
            " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                <div style="font-size: 13px; color: #6b7280; margin-bottom: 4px;">
                    Active วันนี้
                </div>
                <div style="font-size: 26px; font-weight: 700; color: #16a34a;">
                    {{ active_users_today }}
                </div>
            </div>
        </a>

        <!-- New users today -->
        <a href="{% url 'custom_admin' %}?filter=new_today" style="text-decoration: none;">
            <div style="
                background-color: #ffffff;
                border-radius: 12px;
                border: 1px solid #e5e7eb;
                box-shadow: 0 2px 6px rgba(0,0,0,0.05);
                padding: 14px 16px;
                cursor: pointer;
                transition: transform 0.1s;
            " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                <div style="font-size: 13px; color: #6b7280; margin-bottom: 4px;">
                    สมาชิกใหม่วันนี้
                </div>
                <div style="font-size: 26px; font-weight: 700; color: #2563eb;">
                    {{ new_users_today }}
                </div>
            </div>
        </a>
    </div>

    <!-- แถวสอง: KPI ภาพ / โมเดล / แท็ก -->
    <div style="
        display: grid;
        grid-template-columns: repeat(4, minmax(0, 1fr));
        gap: 16px;
        margin-bottom: 28px;
    ">
        <a href="{% url 'admin_image_list' %}" style="text-decoration: none;">
            <div style="
                background-color: #ffffff;
                border-radius: 12px;
                border: 1px solid #e5e7eb;
                box-shadow: 0 2px 6px rgba(0,0,0,0.05);
                padding: 12px 14px;
                cursor: pointer;
                transition: transform 0.1s;
            " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                <div style="font-size: 12px; color: #6b7280; margin-bottom: 3px;">
                    ภาพที่สร้างทั้งหมด
                </div>
                <div style="font-size: 20px; font-weight: 700; color: #111827;">
                    {{ total_generated_images }}
                </div>
            </div>
        </a>

        <a href="{% url 'admin_image_list' %}?filter=today" style="text-decoration: none;">
            <div style="
                background-color: #ffffff;
                border-radius: 12px;
                border: 1px solid #e5e7eb;
                box-shadow: 0 2px 6px rgba(0,0,0,0.05);
                padding: 12px 14px;
                cursor: pointer;
                transition: transform 0.1s;
            " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                <div style="font-size: 12px; color: #6b7280; margin-bottom: 3px;">
                    ภาพที่สร้างวันนี้
                </div>
                <div style="font-size: 20px; font-weight: 700; color: #16a34a;">
                    {{ generated_today }}
                </div>
            </div>
        </a>

        <a href="{% url 'custom_model' %}" style="text-decoration: none;">
            <div style="
                background-color: #ffffff;
                border-radius: 12px;
                border: 1px solid #e5e7eb;
                box-shadow: 0 2px 6px rgba(0,0,0,0.05);
                padding: 12px 14px;
                cursor: pointer;
                transition: transform 0.1s;
            " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                <div style="font-size: 12px; color: #6b7280; margin-bottom: 3px;">
                    Custom Models ที่ Active
                </div>
                <div style="font-size: 20px; font-weight: 700; color: #111827;">
                    {{ active_models }}
                </div>
            </div>
        </a>

        <a href="{% url 'admin_tag_list' %}" style="text-decoration: none;">
            <div style="
                background-color: #ffffff;
                border-radius: 12px;
                border: 1px solid #e5e7eb;
                box-shadow: 0 2px 6px rgba(0,0,0,0.05);
                padding: 12px 14px;
                cursor: pointer;
                transition: transform 0.1s;
            " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                <div style="font-size: 12px; color: #6b7280; margin-bottom: 3px;">
                    จำนวน Tags
                </div>
                <div style="font-size: 20px; font-weight: 700; color: #111827;">
                    {{ tags_count }}
                </div>
            </div>
        </a>
    </div>

    <!-- แถวสาม: สองคอลัมน์ซ้ายขวา -->
    <div style="
        display: grid;
        grid-template-columns: 2fr 1.5fr;
        gap: 20px;
        margin-bottom: 28px;
    ">
        <!-- ตารางภาพที่สร้างล่าสุด -->
        <div style="
            background-color: #ffffff;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            overflow: hidden;
        ">
            <div style="padding: 12px 16px; border-bottom: 1px solid #e5e7eb; font-weight: 600;">
                ภาพที่สร้างล่าสุด
            </div>
            <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                <thead>
                    <tr style="background-color: #f9fafb;">
                        <th style="padding: 8px 10px; text-align: left; font-weight: 600; color: #4b5563;">User</th>
                        <th style="padding: 8px 10px; text-align: left; font-weight: 600; color: #4b5563;">Model</th>
                        <th style="padding: 8px 10px; text-align: left; font-weight: 600; color: #4b5563;">Prompt</th>
                        <th style="padding: 8px 10px; text-align: left; font-weight: 600; color: #4b5563;">Seed</th>
                        <th style="padding: 8px 10px; text-align: left; font-weight: 600; color: #4b5563;">Time</th>
                    </tr>
                </thead>
                <tbody>
                    {% for img in recent_images %}
                    <tr style="border-top: 1px solid #e5e7eb;">
                        <td style="padding: 8px 10px; color: #111827;">{{ img.user }}</td>
                        <td style="padding: 8px 10px; color: #374151;">{{ img.model_name }}</td>
                        <td
                            style="padding: 8px 10px; color: #4b5563; max-width: 220px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                            {{ img.positive_prompt }}
                        </td>
                        <td style="padding: 8px 10px; color: #374151;">{{ img.seed }}</td>
                        <td style="padding: 8px 10px; color: #6b7280;">{{ img.created_at|timesince }} ago</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" style="padding: 10px; text-align: center; color: #6b7280;">
                            ยังไม่มีประวัติการสร้างภาพ
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- ตารางสมาชิกใหม่ล่าสุด -->
        <div style="
            background-color: #ffffff;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            overflow: hidden;
        ">
            <div style="padding: 12px 16px; border-bottom: 1px solid #e5e7eb; font-weight: 600;">
                สมาชิกใหม่ล่าสุด
            </div>
            <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                <thead>
                    <tr style="background-color: #f9fafb;">
                        <th style="padding: 8px 10px; text-align: left; font-weight: 600; color: #4b5563;">Username</th>
                        <th style="padding: 8px 10px; text-align: left; font-weight: 600; color: #4b5563;">Email</th>
                        <th style="padding: 8px 10px; text-align: left; font-weight: 600; color: #4b5563;">Joined</th>
                    </tr>
                </thead>
                <tbody>
                    {% for u in recent_users %}
                    <tr style="border-top: 1px solid #e5e7eb;">
                        <td style="padding: 8px 10px; color: #111827;">{{ u.username }}</td>
                        <td style="padding: 8px 10px; color: #374151;">{{ u.email|default:"-" }}</td>
                        <td style="padding: 8px 10px; color: #6b7280;">
                            {{ u.date_joined|date:"d/m/Y" }}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="3" style="padding: 10px; text-align: center; color: #6b7280;">
                            ยังไม่มีสมาชิกในระบบ
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- แถวสี่: การใช้งานโมเดล และแท็ก -->
    <div style="
        display: grid;
        grid-template-columns: 1.2fr 1.2fr;
        gap: 20px;
        margin-bottom: 24px;
    ">
        <!-- Model usage -->
        <div style="
            background-color: #ffffff;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            overflow: hidden;
        ">
            <div style="padding: 12px 16px; border-bottom: 1px solid #e5e7eb; font-weight: 600;">
                การใช้งานโมเดล
            </div>
            <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                <thead>
                    <tr style="background-color: #f9fafb;">
                        <th style="padding: 8px 10px; text-align: left; font-weight: 600; color: #4b5563;">Model</th>
                        <th style="padding: 8px 10px; text-align: left; font-weight: 600; color: #4b5563;">Usage</th>
                    </tr>
                </thead>
                <tbody>
                    {% for m in model_usage %}
                    <tr style="border-top: 1px solid #e5e7eb;">
                        <td style="padding: 8px 10px; color: #111827;">{{ m.model_name }}</td>
                        <td style="padding: 8px 10px; color: #374151;">
                            {{ m.count }}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="2" style="padding: 10px; text-align: center; color: #6b7280;">
                            ยังไม่มีข้อมูล
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Tag usage -->
        <div style="
            background-color: #ffffff;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            overflow: hidden;
        ">
            <div style="padding: 12px 16px; border-bottom: 1px solid #e5e7eb; font-weight: 600;">
                Tag ที่ถูกใช้บ่อย
            </div>
            <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                <thead>
                    <tr style="background-color: #f9fafb;">
                        <th style="padding: 8px 10px; text-align: left; font-weight: 600; color: #4b5563;">Tag</th>
                        <th style="padding: 8px 10px; text-align: left; font-weight: 600; color: #4b5563;">จำนวนครั้ง
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {% for t in tag_usage %}
                    <tr style="border-top: 1px solid #e5e7eb;">
                        <td style="padding: 8px 10px; color: #111827;">{{ t.name }}</td>
                        <td style="padding: 8px 10px; color: #374151;">{{ t.count }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="2" style="padding: 10px; text-align: center; color: #6b7280;">
                            ยังไม่มีข้อมูล
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Quick Actions ฟีลเดียวกับปุ่ม + Add New Model -->
    <div style="margin-top: 8px; display: flex; gap: 10px; flex-wrap: wrap;">
        <a href="{% url 'custom_model' %}" style="
                background-color: #16a34a;
                color: #ffffff;
                border-radius: 6px;
                padding: 8px 14px;
                font-size: 14px;
                font-weight: 600;
                text-decoration: none;
           ">
            จัดการ Custom Model
        </a>

        <a href="{% url 'custom_admin' %}" style="
                background-color: #2563eb;
                color: #ffffff;
                border-radius: 6px;
                padding: 8px 14px;
                font-size: 14px;
                font-weight: 600;
                text-decoration: none;
           ">
            จัดการสมาชิก
        </a>

        <a href="{% url 'custom_dimension' %}" style="
                background-color: #f59e0b;
                color: #ffffff;
                border-radius: 6px;
                padding: 8px 14px;
                font-size: 14px;
                font-weight: 600;
                text-decoration: none;
           ">
            ขนาดภาพ (Dimensions)
        </a>

        <a href="{% url 'custom_count' %}" style="
                background-color: #8b5cf6;
                color: #ffffff;
                border-radius: 6px;
                padding: 8px 14px;
                font-size: 14px;
                font-weight: 600;
                text-decoration: none;
           ">
            จำนวนรูป (Counts)
        </a>

        <a href="{% url 'admin_tag_list' %}" style="
                background-color: #ec4899;
                color: #ffffff;
                border-radius: 6px;
                padding: 8px 14px;
                font-size: 14px;
                font-weight: 600;
                text-decoration: none;
           ">
            จัดการ Tags
        </a>

        <a href="{% url 'admin_post_list' %}" style="
                background-color: #6366f1;
                color: #ffffff;
                border-radius: 6px;
                padding: 8px 14px;
                font-size: 14px;
                font-weight: 600;
                text-decoration: none;
           ">
            จัดการ Posts
        </a>

        <a href="{% url 'admin_comment_list' %}" style="
                background-color: #10b981;
                color: #ffffff;
                border-radius: 6px;
                padding: 8px 14px;
                font-size: 14px;
                font-weight: 600;
                text-decoration: none;
           ">
            จัดการ Comments
        </a>

        <!-- ปุ่มอื่นๆ เพิ่มได้ตามต้องการ -->
    </div>
</div>
{% endblock %}